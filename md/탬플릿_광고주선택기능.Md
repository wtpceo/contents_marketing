
# 📑 [PRD] 대량 생산을 위한 스마트 광고주 타겟팅 (Smart Targeting)

**문서 번호:** WCM\_MVP\_Feature\_Bulk\_Targeting\_v1.0
**관련 화면:** 대량 생산 워크스페이스 \> `Step 2. 광고주 선택` 패널
**목표:** 1,000개 이상의 광고주 리스트에서 특정 조건(업종, 지역, 태그)에 맞는 대상을 즉시 추출하고, 그룹으로 관리하여 선택 효율을 극대화한다.

-----

## 1\. UI/UX 개선안 (The Layout)

기존의 단순 카드 리스트(`Image 2025-12-11...1.18.37`)를 **[필터링 컨트롤러] + [데이터 테이블]** 구조로 전면 개편합니다.

### A. 상단: 스마트 컨트롤 바 (Smart Control Bar)

검색과 필터, 그룹 관리가 통합된 영역입니다.

1.  **그룹 불러오기 (Quick Segment):**
      * UI: 드롭다운(Dropdown) 메뉴. `📂 내 그룹 불러오기`
      * 항목: `전체`, `[저장됨] 서울 수학학원`, `[저장됨] 강남 맛집` ...
      * Action: 선택 시 해당 그룹의 필터 조건이 즉시 적용됨.
2.  **스마트 필터 (Multi-Filter):**
      * UI: 검색창 우측 `[+ 필터 추가]` 버튼.
      * 클릭 시 하위 속성 선택:
          * `업종(Category)`: 학원, 병원, 식당...
          * `지역(Location)`: 시/도, 구/군 단위.
          * `상태(Status)`: 활성, 휴면.
          * `태그(Tags)`: \#겨울특강, \#신규오픈 (사용자 커스텀 태그).
      * **적용 모습:** 검색창 하단에 `[지역: 서울 x] [업종: 학원 x]` 형태의 \*\*필터 칩(Chip)\*\*이 나열됨.
3.  **그룹 저장 (Save Segment):**
      * 필터가 하나라도 적용되면 `[이 조건을 그룹으로 저장]` 버튼 활성화.

### B. 중단: 데이터 그리드 (Data Grid)

많은 정보를 밀도 있게 보여주기 위해 **테이블(Table) 형태**로 변경합니다.

  * **헤더:** `[Chk]` | `광고주명` | `업종` | `지역` | `필수 데이터 상태`
  * **리스트 아이템:**
      * **체크박스:** 개별 선택.
      * **필수 데이터 상태:** 현재 선택한 템플릿에 필요한 변수(예: `{{usp}}`)가 이 광고주 DB에 있는지 체크.
          * 🟢 (완료) / 🔴 (누락 - 툴팁으로 "강점 데이터 없음" 표시)

### C. 하단: 대량 선택 액션 (Bulk Actions)

페이지네이션(Pagination)의 한계를 넘는 선택 기능을 제공합니다.

  * **전체 선택 로직:**
      * 헤더의 체크박스 선택 시: **"현재 페이지의 10개가 선택되었습니다."** 토스트 메시지 노출.
      * 이어서 바로 옆에: **"검색 결과 158개 모두 선택하기"** 링크 버튼 노출. (Gmail 방식)
  * **플로팅 액션 버튼 (FAB):**
      * 우측 하단에 **`총 158개 광고주 선택됨`** → **`[생성하기]`** 버튼 고정.

-----

## 2\. 기능 명세 (Functional Specs)

### 1\. 필터링 로직 (Filtering)

  * 모든 필터 조건은 **AND 조건**으로 동작합니다. (예: 서울 AND 학원 AND \#겨울타겟)
  * 검색어(Keyword)는 광고주명과 태그를 동시에 검색합니다.

### 2\. 그룹(Segment) 관리

  * **정의:** 특정 광고주 ID들을 저장하는 게 아니라, \*\*'필터 조건(Query)'\*\*을 저장해야 합니다. (그래야 나중에 광고주가 추가돼도 조건에 맞으면 자동 포함됨)
  * **CRUD:** 그룹 생성, 조회, 삭제 기능 필요.

### 3\. 데이터 검증 (Data Validation) - *중요*

템플릿 매칭 시 '구멍'을 방지하기 위한 로직입니다.

  * **Pre-check:** 사용자가 템플릿을 선택하면, 시스템은 해당 템플릿에 필요한 변수(예: `{{menu}}`)를 파악합니다.
  * **Visual Cue:** 광고주 리스트에서 해당 데이터가 비어있는 광고주는 **행(Row)을 붉은색 틴트**로 표시하거나 경고 아이콘을 띄워, 사용자가 선택 전 인지하게 합니다.

-----

## 3\. 개발팀 작업 지시서 (Technical Requirements)

### 🗄️ Backend (DB & API)

**1. `advertiser_groups` 테이블 신설**

```sql
CREATE TABLE advertiser_groups (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  owner_id UUID REFERENCES users(id),
  name VARCHAR(255) NOT NULL,
  filter_conditions JSONB NOT NULL, -- 예: {"location": "Seoul", "category": "Academy"}
  created_at TIMESTAMP DEFAULT NOW()
);
```

**2. 광고주 조회 API 고도화 (`GET /api/advertisers`)**

  * Query Params 지원: `?category=...&location=...&tags=...&search=...`
  * Response에 `meta` 정보(전체 개수, 현재 페이지 등) 필수 포함.

### 🖥️ Frontend (Components)

**1. `AdvertiserFilterBar` 컴포넌트**

  * Chip Input 기반의 필터 UI 구현.
  * 필터 상태(`filters` state)가 변경될 때마다 API 리페치(Refetch).

**2. `BulkSelectionHandler` 로직**

  * **State 구조 제안:**
    ```javascript
    const [selectionMode, setSelectionMode] = useState('page'); // 'page' or 'all'
    const [selectedIds, setSelectedIds] = useState(new Set()); // 개별 선택된 ID들
    const [excludeIds, setExcludeIds] = useState(new Set()); // '전체 선택' 모드에서 제외할 ID들
    ```
  * **API 전송 시:** `selectionMode === 'all'`이면 개별 ID 리스트 대신 **`currentFilter` 조건 객체**와 \*\*`excludeIds`\*\*를 서버로 전송하여, 서버가 쿼리로 대상을 찾도록 처리 (성능 최적화).

