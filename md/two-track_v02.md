개발팀에게 **"기존 투 트랙 시스템 위에 이 기능을 얹어주세요"**라고 전달하시면 됩니다.

---

# 📑 [PRD] 확장 기능: 공용 템플릿 마켓 & 스마트 치환 시스템

**문서 번호:** WCE_Ext_01_Public_Template
**관련 문서:** WCE_PRD_Two_Track_Content_System_v1.0
**작성일:** 2025.12.11
**목표:** 관리자가 등록한 '공용 템플릿'을 모든 유저가 사용하여, 생성 비용을 최소화(단순 치환)하면서도 대량의 콘텐츠를 공급하는 생태계 구축.

---

## 1. 데이터베이스 설계 변경 (Database Schema)

기존 `templates` 테이블을 확장하여 **'내 것'**과 **'공용'**을 구분해야 합니다.

### A. `templates` 테이블 컬럼 추가
* **`visibility` (Enum):** 템플릿의 노출 범위를 정의.
    * `'private'` (Default): 생성한 본인만 사용 가능 (기존 로직).
    * **`'public'` (New):** 시스템 관리자가 등록, 모든 유저에게 노출 (읽기 전용).
* **`variables` (JSONB, Optional):** 템플릿에 사용된 변수 목록을 저장하여 프론트엔드에서 안내.
    * 예: `["company_name", "phone", "location", "usp"]`

---

## 2. 핵심 로직: 스마트 치환 엔진 (Smart Replacement Engine)

**기존 생성 방식(Creative Generation)**과 달리, 이 로직은 **'단어 갈아 끼우기(Replacement)'** 방식이므로 토큰 비용을 획기적으로 절감합니다.

### A. 표준 변수 정의 (Standard Variables)
모든 템플릿은 아래 약속된 변수명을 사용하여 작성됩니다.
* `{{company_name}}`: 업체명
* `{{location}}`: 지역 (예: 강남구, 부산 서면)
* `{{phone}}`: 전화번호
* `{{usp}}`: 강점/차별점 (Smart Import로 학습된 `advanced_profile` 데이터 활용)
* `{{menu}}`: 대표 메뉴/서비스

### B. 생성 프로세스 (Backend Logic)
**API:** `POST /api/contents/bulk` (기존 API 로직 분기 처리)

1.  **템플릿 로드:** 선택된 템플릿의 텍스트 로드.
2.  **광고주 루프 (Loop):** 선택된 광고주 ID 리스트를 순회.
3.  **1차 단순 치환 (Hard Replacement):**
    * 텍스트 내의 `{{company_name}}` 등을 광고주 DB 값으로 1:1 교체.
4.  **2차 문맥 보정 (AI Post-Processing) - *High Quality Option*:**
    * *문제점:* 단순 치환 시 한국어 조사 오류 발생 가능 (예: "위즈더플래닝**이**" vs "위즈더플래닝**가**").
    * *해결:* **GPT-4o-mini** (초저비용 모델)를 사용하여 문법만 교정.
    * *Prompt:* "다음 텍스트에서 단어 치환으로 인해 어색해진 한국어 조사(은/는/이/가/을/를)만 자연스럽게 수정해서 원문 그대로 반환해. 내용은 바꾸지 마."

---

## 3. UI/UX 화면 설계 (Frontend)

기존 **'Track 2: 대량 생산 워크스페이스'** 화면을 고도화합니다.

### A. 템플릿 선택 패널 (Tab 구분)
* **Tab 1: 🔥 위플 공식 템플릿 (Public)**
    * 관리자가 등록한 고퀄리티 템플릿 리스트.
    * 카테고리 필터: `[학원]`, `[병원]`, `[맛집]`, `[시즌이슈]`
    * 카드 UI: 썸네일 + 사용된 변수 태그(`사용 변수: 업체명, 지역`) 표시.
* **Tab 2: 📂 내 템플릿 (Private)**
    * 유저가 직접 등록한 템플릿.

### B. 미리보기 및 변수 매핑 (Preview & Mapping)
* 공식 템플릿 선택 시, 우측에 **'치환 시뮬레이션'** 제공.
* "이 템플릿은 광고주의 **[강점]** 데이터가 필요합니다." 라는 안내 문구 노출.
    * *예외 처리:* 만약 선택한 광고주에게 '강점' 데이터가 비어있다면? $\rightarrow$ ⚠️ 경고 아이콘 노출 및 "기본값(Default) 입력 필요" 알림.

---

## 4. 관리자 기능 (Admin Only)

대표님(관리자)이 공용 템플릿을 등록하는 백오피스 기능입니다.

* **템플릿 등록 에디터:**
    * 변수 삽입 버튼 제공 (클릭 시 `{{...}}` 삽입).
    * **'Public'** 체크박스: 체크 시 모든 유저의 '위플 공식 템플릿' 탭에 노출됨.

---

## 5. 개발팀 전달 사항 (Action Items)

1.  **[Backend]** `templates` 테이블에 `visibility` 컬럼 추가하고, 템플릿 조회 API(`GET /api/templates`)에 `scope` 필터링 로직 추가해주세요.
2.  **[Backend]** 대량 생성 로직에서 템플릿 사용 시, **Full Generation(전체 창작)**이 아니라 **Replacement(치환) + Mini Model Correction(문법 보정)** 프로세스로 타도록 최적화해주세요. (비용 절감 핵심)
3.  **[Frontend]** 대량 생산 화면에서 템플릿 리스트를 `공식`과 `개인`으로 탭 분리해서 보여주세요.

